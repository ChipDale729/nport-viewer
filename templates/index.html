<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>N-PORT Holdings Viewer</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; }
      .row { display: flex; gap: .5rem; align-items: center; flex-wrap: wrap; }
      input { padding: .5rem .75rem; font-size: 1rem; }
      button { padding: .5rem .75rem; font-size: 1rem; cursor: pointer; }
      table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
      th, td { border: 1px solid #ddd; padding: .5rem; text-align: left; }
      th { background: #f6f6f6; user-select: none; }
      th.sortable { cursor: pointer; }
      th.sortable .arrow { opacity: .5; font-size: .9em; margin-left: .35rem; }
      #status { margin-top: .75rem; color: #444; }
      .muted { color: #777; }
      .controls { display: flex; gap: .75rem; align-items: center; margin-top: .5rem; }
      .right { text-align: right; }
      .chart-wrap { margin: 1rem 0; }
      .chart-title { margin: .25rem 0 .5rem; font-weight: 600; color: #444; }
    </style>
  </head>
  <body>
    <h1>N-PORT Holdings Viewer</h1>
    <p class="muted">Enter a fund's CIK to fetch the latest Form N-PORT holdings (Part C).</p>

    <div class="row">
      <input id="cik" placeholder="CIK (e.g., 0000884394 for SPY)" />
      <button id="go">Fetch</button>
      <span id="status"></span>
    </div>

    <div class="chart-wrap">
      <h3 id="chart-title" style="display:none; margin-top:1.5rem;">Top 30 holdings by value</h3>
      <canvas id="pie" width="600" height="360" style="display:none;"></canvas>
    </div>

    <div class="controls" id="filterBox" style="display:none;">
      <label>Filter by name: <input id="filter" placeholder="e.g., Inc" /></label>
    </div>

    <table id="tbl" hidden>
      <thead>
        <tr>
          <th data-key="cusip" class="sortable">CUSIP <span class="arrow"></span></th>
          <th data-key="name" class="sortable">Title/Name <span class="arrow"></span></th>
          <th data-key="balance" class="sortable">Balance <span class="arrow"></span></th>
          <th data-key="valueUsd" class="sortable">Value (USD) <span class="arrow"></span></th>
          <th data-key="percentValue" class="sortable">Percent of Total <span class="arrow"></span></th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td id="total-balance" class="right muted"></td>
          <td id="total-value" class="right muted"></td>
        </tr>
      </tfoot>
    </table>

    <!-- Chart.js + datalabels plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <script src="/static/app.js"></script>
  </body>
</html>
